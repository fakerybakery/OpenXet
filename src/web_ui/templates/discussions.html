{% extends "base.html" %}

{% block title %}Community - {{ full_name }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">Home</a> / <a href="/{{ owner }}">{{ owner }}</a> / <a href="/{{ full_name }}">{{ repo_name }}</a> / Community
</div>

<div class="flex items-center justify-between mb-2">
    <h2 style="margin: 0;">{{ full_name }}</h2>
</div>

<div class="tabs">
    <a href="/{{ full_name }}" class="tab">Files</a>
    <a href="/{{ full_name }}/discussions" class="tab active">Community</a>
</div>

<div class="flex items-center justify-between mb-2">
    <div>
        <span class="text-muted">{{ discussion_count }} discussion{% if discussion_count != 1 %}s{% endif %}</span>
    </div>
    {% if current_user %}
    <a href="/{{ full_name }}/discussions/new" class="btn btn-primary">New Discussion</a>
    {% else %}
    <a href="/-/login" class="btn">Sign in to discuss</a>
    {% endif %}
</div>

{% if discussions %}
<div class="card">
    <ul class="list">
        {% for disc in discussions %}
        <li class="list-item" style="flex-direction: column; align-items: flex-start; gap: 4px; padding: 10px 12px;">
            <div style="display: flex; align-items: center; gap: 8px; width: 100%;">
                {% if disc.status == "open" %}
                <svg width="16" height="16" viewBox="0 0 16 16" fill="#5c5" style="flex-shrink: 0;">
                    <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                {% else %}
                <svg width="16" height="16" viewBox="0 0 16 16" fill="#a371f7" style="flex-shrink: 0;">
                    <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                    <path d="M5 8l2 2 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                {% endif %}
                <a href="/{{ full_name }}/discussions/{{ disc.id }}" style="font-weight: 500; flex: 1;">{{ disc.title }}</a>
                <span class="badge">{{ disc.comment_count }} {% if disc.comment_count == 1 %}comment{% else %}comments{% endif %}</span>
            </div>
            <div style="font-size: 11px; color: #666; margin-left: 24px;">
                opened {{ disc.created_at }} by <span style="color: #999;">{{ disc.author }}</span>
                {% if disc.updated_at != disc.created_at %}
                &middot; updated {{ disc.updated_at }}
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% else %}
<div class="card">
    <div class="empty">
        <p style="margin-bottom: 12px;">No discussions yet</p>
        {% if current_user %}
        <a href="/{{ full_name }}/discussions/new" class="btn btn-primary">Start the first discussion</a>
        {% else %}
        <p class="text-muted text-sm">Sign in to start a discussion</p>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
