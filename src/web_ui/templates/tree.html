{% extends "base.html" %}
{% block title %}{{ repo_name }}/{{ path }} - OpenXet{% endblock %}
{% block content %}
<div class="breadcrumb">
    <a href="/">Repositories</a> /
    <a href="/{{ full_name }}">{{ full_name }}</a> /
    <a href="/{{ full_name }}?tab=files&branch={{ ref_name }}">{{ ref_name }}</a>
    {% for crumb in breadcrumbs %} / <a href="/{{ full_name }}/tree/{{ ref_name }}/{{ crumb.path }}">{{ crumb.name }}</a>{% endfor %}
</div>

<div class="flex items-center justify-between mb-2">
    <h2 style="margin: 0;">{{ current_name }}</h2>
    <div class="flex items-center gap-2">
        <a href="/{{ full_name }}/new/{{ ref_name }}{% if path %}/{{ path }}{% endif %}" class="btn">New File</a>
        <select class="branch-select" onchange="window.location.href='/{{ full_name }}/tree/' + this.value + '{% if path %}/{{ path }}{% endif %}'">
            {% for branch in branches %}
            <option value="{{ branch.name }}" {% if branch.name == ref_name %}selected{% endif %}>{{ branch.name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div class="card">
    <ul class="list">
        {% if parent_path is defined %}
        <li class="list-item">
            <svg class="icon icon-folder" viewBox="0 0 16 16" fill="currentColor"><path d="M1.75 2.5a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25v-8.5a.25.25 0 00-.25-.25H7.5c-.55 0-1.07-.26-1.4-.7l-.9-1.2a.25.25 0 00-.2-.1H1.75z"/></svg>
            <a href="/{{ full_name }}/tree/{{ ref_name }}{% if parent_path %}/{{ parent_path }}{% endif %}">..</a>
        </li>
        {% endif %}
        {% for entry in entries %}
        <li class="list-item">
            {% if entry.is_dir %}
            <svg class="icon icon-folder" viewBox="0 0 16 16" fill="currentColor"><path d="M1.75 2.5a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25v-8.5a.25.25 0 00-.25-.25H7.5c-.55 0-1.07-.26-1.4-.7l-.9-1.2a.25.25 0 00-.2-.1H1.75z"/></svg>
            <a href="/{{ full_name }}/tree/{{ ref_name }}/{{ entry.full_path }}">{{ entry.name }}</a>
            {% else %}
            <svg class="icon icon-file" viewBox="0 0 16 16" fill="currentColor"><path d="M3.75 1.5a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V4.664a.25.25 0 00-.073-.177l-2.914-2.914a.25.25 0 00-.177-.073H3.75z"/></svg>
            <a href="/{{ full_name }}/blob/{{ ref_name }}/{{ entry.full_path }}">{{ entry.name }}</a>
            {% if entry.is_lfs %}
                {% if entry.lfs_status == "chunked" %}<span class="badge badge-green">Xet</span>
                {% elif entry.lfs_status == "processing" %}<span class="badge badge-yellow">Processing</span>
                {% elif entry.lfs_status == "raw" %}<span class="badge badge-blue">LFS</span>
                {% else %}<span class="badge">LFS</span>{% endif %}
            {% endif %}
            {% endif %}
            <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
                {% if entry.lfs_size %}<span class="text-muted text-sm">{{ entry.lfs_size }}</span>{% endif %}
                {% if entry.is_lfs and entry.lfs_oid %}
                <a href="/{{ full_name }}.git/info/lfs/objects/{{ entry.lfs_oid }}" class="btn" style="padding: 2px 6px;">DL</a>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
