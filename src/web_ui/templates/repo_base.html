{% extends "base.html" %}
{% block content %}
<div class="breadcrumb">
    <a href="/">Repositories</a> / <a href="/{{ owner }}">{{ owner }}</a> / <strong>{{ repo_name }}</strong>
    {% block breadcrumb_extra %}{% endblock %}
</div>

<div class="flex items-center justify-between mb-3">
    <h1 style="font-size: 18px; font-weight: 600;">{{ full_name }}</h1>
    <div class="flex items-center gap-2">
        {% block header_actions %}
        {% if branches %}
        <a href="/{{ full_name }}/new/{{ current_branch | default(value=ref_name) | default(value='main') }}" class="btn">New File</a>
        <select name="branch" class="select" onchange="handleBranchChange(this.value)">
            {% for branch in branches %}
            <option value="{{ branch.name }}" {% if branch.name == current_branch or branch.name == ref_name %}selected{% endif %}>{{ branch.name }}</option>
            {% endfor %}
        </select>
        {% endif %}
        {% endblock %}
    </div>
</div>

<div class="tabs">
    {% if current_branch %}
        {% set current_ref = current_branch %}
    {% elif ref_name %}
        {% set current_ref = ref_name %}
    {% else %}
        {% set current_ref = 'main' %}
    {% endif %}
    {% set tab = active_tab | default(value='') %}
    <a href="/{{ full_name }}?tab=overview&branch={{ current_ref }}" class="tab {% if tab == 'overview' %}active{% endif %}">Overview</a>
    <a href="/{{ full_name }}?tab=files&branch={{ current_ref }}" class="tab {% if tab == 'files' %}active{% endif %}">Files</a>
    <a href="/{{ full_name }}/commits/{{ current_ref }}" class="tab {% if tab == 'commits' %}active{% endif %}">Commits</a>
    <a href="/{{ full_name }}/community" class="tab {% if tab == 'community' or tab == 'pull_requests' %}active{% endif %}">Community</a>
</div>

{% block repo_content %}{% endblock %}

<script>
function handleBranchChange(branch) {
    {% block branch_change_handler %}
    window.location.href = '/{{ full_name | safe }}?tab={{ active_tab | default(value="overview") }}&branch=' + branch;
    {% endblock %}
}
</script>
{% endblock %}
