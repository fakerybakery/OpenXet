{% extends "base.html" %}
{% block title %}{{ owner }} - OpenXet{% endblock %}
{% block content %}
<div class="breadcrumb">
    <a href="/">Repositories</a> / <strong>{{ owner }}</strong>
</div>

<div class="flex items-center gap-3 mb-4">
    {% if is_org %}
    <div class="avatar-lg" style="border-radius: 6px;">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1.5 14.25c0 .138.112.25.25.25H4v-1.25a.75.75 0 01.75-.75h2.5a.75.75 0 01.75.75v1.25h2.25a.25.25 0 00.25-.25V1.75a.25.25 0 00-.25-.25h-8.5a.25.25 0 00-.25.25v12.5z"/>
        </svg>
    </div>
    {% else %}
    <div class="avatar-lg">{{ owner | truncate(length=1, end="") | upper }}</div>
    {% endif %}
    <div>
        <h1 style="font-size: 18px; font-weight: 600; margin: 0;">{{ owner }}</h1>
        <span class="text-sm text-secondary">{% if is_org %}Organization{% else %}User{% endif %}</span>
    </div>
</div>

{% if is_org %}
<!-- Organization -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px;">
    <div>
        <div class="card">
            <div class="card-header">Repositories ({{ repo_count }})</div>
            {% if repos %}
            <ul class="list">
                {% for repo in repos %}
                <li class="list-item">
                    <svg class="icon folder-icon" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8z"/>
                    </svg>
                    <a href="/{{ repo }}">{{ repo }}</a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty">No repositories</div>
            {% endif %}
        </div>
    </div>

    <div>
        <div class="card">
            <div class="card-header">Members ({{ member_count }})</div>
            {% if members %}
            <ul class="list">
                {% for member in members %}
                <li class="list-item justify-between">
                    <div class="flex items-center gap-2">
                        <div class="avatar-sm">{{ member.username | truncate(length=1, end="") | upper }}</div>
                        <a href="/{{ member.username }}">{{ member.username }}</a>
                        {% if member.role == "owner" %}
                        <span class="badge badge-warning" style="height: 16px; font-size: 9px;">owner</span>
                        {% endif %}
                    </div>
                    {% if is_org_owner and member.username != current_user %}
                    <form method="POST" action="/{{ owner }}/members/{{ member.username }}/remove" style="margin: 0;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn btn-sm btn-ghost" onclick="return confirm('Remove {{ member.username }}?')">Remove</button>
                    </form>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty">No members</div>
            {% endif %}

            {% if is_org_owner %}
            <div style="padding: 10px 14px; border-top: 1px solid var(--border);">
                <form method="POST" action="/{{ owner }}/members" class="flex gap-2">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <input type="text" name="username" placeholder="Username" required class="input flex-1" style="height: 28px; font-size: 12px;">
                    <button type="submit" class="btn btn-sm btn-primary">Add</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% else %}
<!-- User -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px;">
    <div>
        <div class="card">
            <div class="card-header">Repositories ({{ repo_count }})</div>
            {% if repos %}
            <ul class="list">
                {% for repo in repos %}
                <li class="list-item">
                    <svg class="icon folder-icon" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8z"/>
                    </svg>
                    <a href="/{{ repo }}">{{ repo }}</a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty">No repositories</div>
            {% endif %}
        </div>
    </div>

    {% if orgs %}
    <div>
        <div class="card">
            <div class="card-header">Organizations ({{ org_count }})</div>
            <ul class="list">
                {% for org in orgs %}
                <li class="list-item">
                    <div class="avatar-sm" style="border-radius: 4px;">
                        <svg width="10" height="10" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.5 14.25c0 .138.112.25.25.25H4v-1.25a.75.75 0 01.75-.75h2.5a.75.75 0 01.75.75v1.25h2.25a.25.25 0 00.25-.25V1.75a.25.25 0 00-.25-.25h-8.5a.25.25 0 00-.25.25v12.5z"/>
                        </svg>
                    </div>
                    <a href="/{{ org.name }}">{{ org.name }}</a>
                    {% if org.role == "owner" %}
                    <span class="badge badge-warning" style="height: 16px; font-size: 9px;">owner</span>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}
