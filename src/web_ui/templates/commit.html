{% extends "repo_base.html" %}
{% block title %}{{ commit.short_id }} - {{ full_name }} - OpenXet{% endblock %}

{% block breadcrumb_extra %} / <strong>{{ commit.short_id }}</strong>{% endblock %}

{% block header_actions %}{% endblock %}

{% block repo_content %}
<div class="card mb-3">
    <div class="card-body">
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">{{ commit.short_message }}</div>
        {% if commit.message != commit.short_message %}
        <div class="text-secondary text-sm" style="white-space: pre-wrap; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">{{ commit.message }}</div>
        {% endif %}
    </div>
    <div class="file-header" style="border-top: 1px solid var(--border); border-bottom: none; flex-direction: column; align-items: flex-start; gap: 4px;">
        <div class="text-sm">
            <strong>{{ commit.author_name }}</strong>
            <span class="text-muted">&lt;{{ commit.author_email }}&gt;</span>
            <span class="text-muted">&middot; {{ commit.author_time_ago }}</span>
        </div>
        <div class="text-xs text-muted font-mono">{{ commit.id }}</div>
        {% if commit.parent_ids %}
        <div class="text-xs text-muted">
            Parent{% if commit.parent_ids | length > 1 %}s{% endif %}:
            {% for parent in commit.parent_ids %}
            <a href="/{{ full_name }}/commit/{{ parent }}" class="font-mono" style="padding: 1px 4px; background: var(--bg-elevated); border-radius: 2px;">{{ parent | truncate(length=7, end="") }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<div class="text-sm text-secondary mb-3">
    <strong>{{ files_changed }}</strong> file{% if files_changed != 1 %}s{% endif %}
    <span class="text-success">+{{ total_additions }}</span>
    <span class="text-error">-{{ total_deletions }}</span>
</div>

{% for file in file_changes %}
<div class="card mb-2">
    <div class="file-header">
        <div class="flex items-center gap-2 font-mono text-sm">
            {% if file.status == "added" %}
            <span style="width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; border-radius: 3px; background: rgba(34, 197, 94, 0.2); color: var(--success);">A</span>
            {% elif file.status == "deleted" %}
            <span style="width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; border-radius: 3px; background: rgba(239, 68, 68, 0.2); color: var(--error);">D</span>
            {% else %}
            <span style="width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; border-radius: 3px; background: rgba(234, 179, 8, 0.2); color: var(--warning);">M</span>
            {% endif %}
            <span>{{ file.path }}</span>
        </div>
        <div class="font-mono text-sm">
            {% if file.additions > 0 %}<span class="text-success">+{{ file.additions }}</span>{% endif %}
            {% if file.deletions > 0 %}<span class="text-error ml-2">-{{ file.deletions }}</span>{% endif %}
        </div>
    </div>
    {% if file.is_binary %}
    <div class="empty" style="padding: 16px;">Binary file</div>
    {% else %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-family: 'SF Mono', monospace; font-size: 12px; line-height: 1.4;">
            {% for line in file.diff_lines %}
            <tr style="{% if line.line_type == 'add' %}background: rgba(34, 197, 94, 0.1);{% elif line.line_type == 'del' %}background: rgba(239, 68, 68, 0.1);{% endif %}">
                <td style="width: 40px; padding: 0 8px; text-align: right; color: var(--text-muted); user-select: none; border-right: 1px solid var(--border);">{% if line.old_line %}{{ line.old_line }}{% endif %}</td>
                <td style="width: 40px; padding: 0 8px; text-align: right; color: var(--text-muted); user-select: none; border-right: 1px solid var(--border);">{% if line.new_line %}{{ line.new_line }}{% endif %}</td>
                <td style="width: 20px; padding: 0 4px; text-align: center; user-select: none; {% if line.line_type == 'add' %}color: var(--success);{% elif line.line_type == 'del' %}color: var(--error);{% else %}color: var(--text-muted);{% endif %}">{% if line.line_type == "add" %}+{% elif line.line_type == "del" %}-{% else %} {% endif %}</td>
                <td style="padding: 0 8px; white-space: pre;">{{ line.content }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}
</div>
{% endfor %}
{% endblock %}
